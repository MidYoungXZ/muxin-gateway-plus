# Muxin Gateway ç½‘å…³ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## é¡¹ç›®æ€»è§ˆ

### å·¥ç¨‹æ¶æ„è¯´æ˜
**muxin-gateway** æ˜¯ä¸€ä¸ªåŸºäº Netty çš„é«˜æ€§èƒ½ API ç½‘å…³ç³»ç»Ÿï¼Œé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒç‹¬ç«‹è¿è¡Œå’Œ Spring ç”Ÿæ€é›†æˆã€‚

#### æ¨¡å—åˆ’åˆ†
```
muxin-gateway/
â”œâ”€â”€ gateway-core/                    # ç½‘å…³æ ¸å¿ƒåŒ…ï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰
â”‚   â”œâ”€â”€ åŸºäº Netty å®ç°çš„ç½‘å…³æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ ä¸ä¾èµ– Spring ç›¸å…³ jar åŒ…
â”‚   â””â”€â”€ å¯ç‹¬ç«‹è¿è¡Œæˆ–é›†æˆ Spring ç”Ÿæ€
â”œâ”€â”€ gateway-core-plus/              # ç½‘å…³æ ¸å¿ƒåŒ…ï¼ˆé‡æ„å¢å¼ºç‰ˆæœ¬ï¼‰âœ¨
â”‚   â”œâ”€â”€ gateway-core çš„é‡æ„å¢å¼ºæ¨¡å—
â”‚   â”œâ”€â”€ æ›´å®Œå–„çš„æ¶æ„è®¾è®¡å’ŒåŠŸèƒ½å®ç°
â”‚   â”œâ”€â”€ æ”¯æŒå¤šåè®®è½¬æ¢ï¼ˆHTTP/gRPC/WebSocket/TCPï¼‰
â”‚   â”œâ”€â”€ å®Œæ•´çš„é…ç½®ç³»ç»Ÿå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â””â”€â”€ æ­£åœ¨å¼€å‘ä¸­ï¼Œå·²å®Œæˆæ ¸å¿ƒæ¶æ„
â”œâ”€â”€ gateway/                        # ç»Ÿä¸€å¯åŠ¨æ¨¡å—
â”‚   â””â”€â”€ åŒ…å«æ‰€æœ‰æ¨¡å—çš„å¯åŠ¨å…¥å£
â”œâ”€â”€ gateway-admin/                  # åå°ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ åŸºäº Spring Boot 3.3.5
â”‚   â”œâ”€â”€ æä¾›å¯è§†åŒ–çš„ç½‘å…³é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ ç›‘æ§æ•°æ®æ”¶é›†å’Œå±•ç¤º
â”‚   â””â”€â”€ ç”¨æˆ·è®¤è¯æˆæƒï¼ˆSa-Tokenï¼‰
â”œâ”€â”€ gateway-registry/               # æ³¨å†Œä¸­å¿ƒæ¨¡å—
â”‚   â””â”€â”€ ç½‘å…³çš„æ³¨å†Œä¸­å¿ƒå…·ä½“å®ç°
â”œâ”€â”€ gateway-config/                 # é…ç½®ä¸­å¿ƒæ¨¡å—
â”‚   â””â”€â”€ ç½‘å…³çš„é…ç½®ä¸­å¿ƒå…·ä½“å®ç°
â””â”€â”€ gateway-spring-boot-starter/    # Spring Boot å¯åŠ¨å™¨
    â””â”€â”€ Spring Boot é¡¹ç›®å¿«é€Ÿé›†æˆ muxin ç½‘å…³
```

### æŠ€æœ¯æ¶æ„ç‰¹ç‚¹
- **åŒæ ¸å¿ƒè®¾è®¡**ï¼šgateway-coreï¼ˆåŸºç¡€ç‰ˆï¼‰+ gateway-core-plusï¼ˆå¢å¼ºç‰ˆï¼‰
- **æ— ä¾µå…¥é›†æˆ**ï¼šå¯ç‹¬ç«‹è¿è¡Œï¼Œä¹Ÿå¯æ— ç¼é›†æˆ Spring ç”Ÿæ€
- **å¤šåè®®æ”¯æŒ**ï¼šHTTPã€gRPCã€WebSocketã€TCP åè®®è½¬æ¢
- **é…ç½®é©±åŠ¨**ï¼šYAML é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±é…ç½®
- **é«˜æ€§èƒ½**ï¼šåŸºäº Netty NIOï¼Œæ”¯æŒé«˜å¹¶å‘è¯·æ±‚å¤„ç†
- **å¯è§†åŒ–ç®¡ç†**ï¼šWeb æ§åˆ¶å°ï¼Œä¾¿äºè¿ç»´ç®¡ç†

## gateway-core-plus æ¨¡å—å®ç°è¿›åº¦åˆ†æ

### ğŸš€ æ¶æ„è®¾è®¡å®Œæ•´åº¦ï¼š**95%**

#### æ ¸å¿ƒç»„ä»¶æ¶æ„ âœ…
```java
// å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
GatewayBootstrap âœ…
â”œâ”€â”€ GatewayProcessor âœ…           # æ ¸å¿ƒè¯·æ±‚å¤„ç†å™¨
â”œâ”€â”€ RouteManager âœ…               # è·¯ç”±ç®¡ç†å™¨  
â”œâ”€â”€ FilterManager âœ…              # è¿‡æ»¤å™¨ç®¡ç†å™¨
â”œâ”€â”€ LoadBalanceManager âœ…         # è´Ÿè½½å‡è¡¡ç®¡ç†å™¨
â”œâ”€â”€ NodeManager âœ…                # èŠ‚ç‚¹ç®¡ç†å™¨
â”œâ”€â”€ ConnectionPoolManager âœ…      # è¿æ¥æ± ç®¡ç†å™¨
â”œâ”€â”€ ProtocolConverterManager âœ…   # åè®®è½¬æ¢ç®¡ç†å™¨
â””â”€â”€ NettyHttpServer âœ…            # HTTP æœåŠ¡å™¨
```

#### é…ç½®ç³»ç»Ÿ âœ…
- **GatewayConfig**ï¼šç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œæ”¯æŒå¼€å‘/ç”Ÿäº§ç¯å¢ƒ
- **GatewayConfigLoader**ï¼šYAML é…ç½®åŠ è½½å™¨ï¼Œæ”¯æŒæ–‡ä»¶å’Œå­—ç¬¦ä¸²åŠ è½½
- **GatewayRouteConfig**ï¼šè·¯ç”±é…ç½®ï¼Œæ”¯æŒå¤æ‚çš„è·¯ç”±è§„åˆ™
- **å„ç»„ä»¶é…ç½®ç±»**ï¼šServerConfigã€ConnectionPoolConfig ç­‰

### ğŸ”§ åŠŸèƒ½å®ç°å®Œæ•´åº¦ï¼š**85%**

#### è·¯ç”±ç³»ç»Ÿ âœ… (100%)
```yaml
# æ”¯æŒçš„è·¯ç”±é…ç½®ç‰¹æ€§
âœ… å¤šç§æ–­è¨€ç±»å‹ï¼šPATHã€METHODã€HEADER
âœ… è¿‡æ»¤å™¨é“¾ï¼šREQUEST_LOGã€AUTHã€CORS ç­‰
âœ… è´Ÿè½½å‡è¡¡ï¼šROUND_ROBINã€WEIGHTED_ROUND_ROBINã€LEAST_CONNECTIONSã€CONSISTENT_HASH
âœ… è¶…æ—¶é…ç½®ï¼šè¿æ¥è¶…æ—¶ã€è¯·æ±‚è¶…æ—¶ã€æ€»è¶…æ—¶
âœ… é™æ€åœ°å€ vs æœåŠ¡å‘ç°ä¸¤ç§æ¨¡å¼
âœ… è·¯ç”±ä¼˜å…ˆçº§å’Œå¯ç”¨/ç¦ç”¨æ§åˆ¶
```

#### åè®®æ”¯æŒ âœ… (90%)
```yaml
âœ… HTTP/1.1 â†’ HTTP/1.1 (æ ‡å‡†ä»£ç†)
âœ… HTTP â†’ gRPC (åè®®è½¬æ¢)  
âœ… WebSocket â†’ TCP (åè®®è½¬æ¢)
âœ… åè®®é…ç½®å’Œç‰ˆæœ¬ç®¡ç†
ğŸš§ HTTP/2 æ”¯æŒ (éƒ¨åˆ†å®ç°)
âŒ è‡ªå®šä¹‰åè®®æ‰©å±• (é¢„ç•™æ¥å£)
```

#### è¿æ¥ç®¡ç† âœ… (95%)
```java
âœ… è¿æ¥æ± ç®¡ç† (DefaultConnectionPoolManager)
âœ… è¿æ¥å·¥å‚ (ConnectionFactory)
âœ… è¿æ¥çŠ¶æ€ç®¡ç† (ConnectionStatus)
âœ… è¿æ¥ç›‘å¬å™¨ (ConnectionListener)
âœ… HTTP è¿æ¥æ± å®ç°
ğŸš§ gRPC è¿æ¥æ±  (éƒ¨åˆ†å®ç°)
```

#### è¿‡æ»¤å™¨ç³»ç»Ÿ âœ… (85%)
```java
âœ… è¿‡æ»¤å™¨æ¥å£å’Œç®¡ç†å™¨
âœ… è¿‡æ»¤å™¨é“¾æ‰§è¡Œ
âœ… å†…ç½®è¿‡æ»¤å™¨ï¼š
  â”œâ”€â”€ HttpLoggingFilter âœ…     # è¯·æ±‚æ—¥å¿—
  â”œâ”€â”€ HttpAuthFilter âœ…        # è®¤è¯è¿‡æ»¤å™¨
  â”œâ”€â”€ CorsFilter ğŸš§            # CORS (é…ç½®å®ç°)
  â””â”€â”€ MetricsFilter ğŸš§         # ç›‘æ§æŒ‡æ ‡ (é¢„ç•™)
```

#### è´Ÿè½½å‡è¡¡ âœ… (80%)
```java
âœ… è´Ÿè½½å‡è¡¡ç®¡ç†å™¨å’Œç­–ç•¥æ¥å£
âœ… è½®è¯¢è´Ÿè½½å‡è¡¡ (RoundRobinLoadBalancer)
ğŸš§ åŠ æƒè½®è¯¢ (é…ç½®ä¸­å®šä¹‰ï¼Œå®ç°å¾…å®Œå–„)
ğŸš§ æœ€å°‘è¿æ¥ (é…ç½®ä¸­å®šä¹‰ï¼Œå®ç°å¾…å®Œå–„) 
ğŸš§ ä¸€è‡´æ€§å“ˆå¸Œ (é…ç½®ä¸­å®šä¹‰ï¼Œå®ç°å¾…å®Œå–„)
```

### ğŸ“ é…ç½®ç³»ç»Ÿå®Œæ•´åº¦ï¼š**95%**

#### YAML é…ç½®æ”¯æŒ âœ…
```yaml
âœ… å®Œæ•´çš„è·¯ç”±é…ç½®æ ¼å¼ (538è¡Œç¤ºä¾‹é…ç½®)
âœ… å…¨å±€ç½‘å…³é…ç½®
âœ… æœåŠ¡å™¨é…ç½® (HTTP/HTTPS/Management)
âœ… æ³¨å†Œä¸­å¿ƒé…ç½® (Nacos/Eureka/Consul)
âœ… ç›‘æ§é…ç½® (Metrics/Tracing/Logging)
âœ… å®‰å…¨é…ç½®
âœ… åè®®é…ç½®
âœ… è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®
```

#### é…ç½®åŠ è½½ âœ…
```java
âœ… YamlConfigDemo - é…ç½®æ¼”ç¤ºå’Œæµ‹è¯•
âœ… æ–‡ä»¶é…ç½®åŠ è½½
âœ… å­—ç¬¦ä¸²é…ç½®åŠ è½½  
âœ… é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†
âœ… ç¯å¢ƒå˜é‡æ”¯æŒ (${VAR:default})
```

### ğŸŒ æœåŠ¡å™¨å®ç°ï¼š**90%**

#### HTTP æœåŠ¡å™¨ âœ…
```java
âœ… NettyHttpServer - åŸºäº Netty çš„ HTTP æœåŠ¡å™¨
âœ… HttpServerConfig - HTTP æœåŠ¡å™¨é…ç½®
âœ… è¯·æ±‚å¤„ç†æµç¨‹é›†æˆ
âœ… è¿æ¥ç®¡ç†å’Œèµ„æºæ¸…ç†
ğŸš§ HTTPS æ”¯æŒ (é…ç½®é¢„ç•™ï¼Œå®ç°å¾…å®Œå–„)
ğŸš§ HTTP/2 æ”¯æŒ (é¢„ç•™)
```

### ğŸ” å½“å‰å¼€å‘çŠ¶æ€

#### âœ… å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½
1. **å®Œæ•´çš„å¯åŠ¨æµç¨‹**ï¼šä»é…ç½®åŠ è½½åˆ°æœåŠ¡å¯åŠ¨çš„å®Œæ•´é“¾è·¯
2. **è·¯ç”±åŒ¹é…å¼•æ“**ï¼šæ”¯æŒå¤æ‚çš„è·¯ç”±è§„åˆ™å’Œæ–­è¨€
3. **åŸºç¡€åè®®è½¬æ¢**ï¼šHTTP åˆ°å…¶ä»–åè®®çš„è½¬æ¢æ¡†æ¶
4. **è¿æ¥æ± ç®¡ç†**ï¼šé«˜æ€§èƒ½çš„è¿æ¥å¤ç”¨æœºåˆ¶
5. **è¿‡æ»¤å™¨æ¡†æ¶**ï¼šå¯æ‰©å±•çš„è¯·æ±‚å¤„ç†ç®¡é“
6. **é…ç½®ç³»ç»Ÿ**ï¼šçµæ´»çš„ YAML é…ç½®å’Œçƒ­åŠ è½½æœºåˆ¶

#### ğŸš§ æ­£åœ¨å¼€å‘çš„åŠŸèƒ½
1. **è´Ÿè½½å‡è¡¡ç®—æ³•**ï¼šé™¤è½®è¯¢å¤–çš„å…¶ä»–ç­–ç•¥å®ç°
2. **ç›‘æ§æŒ‡æ ‡æ”¶é›†**ï¼šMetrics å’Œ Tracing çš„å…·ä½“å®ç°
3. **gRPC åè®®æ”¯æŒ**ï¼šåè®®è½¬æ¢çš„å®Œæ•´å®ç°
4. **å¥åº·æ£€æŸ¥**ï¼šæœåŠ¡èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€æ£€æµ‹

#### âŒ å¾…å¼€å‘çš„åŠŸèƒ½
1. **æœåŠ¡å‘ç°é›†æˆ**ï¼šä¸ Nacosã€Eureka ç­‰æ³¨å†Œä¸­å¿ƒçš„å®é™…é›†æˆ
2. **é…ç½®çƒ­æ›´æ–°**ï¼šé…ç½®å˜æ›´çš„åŠ¨æ€ç”Ÿæ•ˆæœºåˆ¶
3. **é™æµç†”æ–­**ï¼šæµé‡æ§åˆ¶å’Œæ•…éšœä¿æŠ¤æœºåˆ¶
4. **å®‰å…¨è®¤è¯**ï¼šJWTã€OAuth2 ç­‰è®¤è¯æœºåˆ¶çš„é›†æˆ

### ğŸ“Š æ•´ä½“è¯„ä¼°

| æ¨¡å— | å®Œæˆåº¦ | çŠ¶æ€ | è¯´æ˜ |
|------|--------|------|------|
| æ ¸å¿ƒæ¶æ„ | 95% | âœ… å®Œæˆ | ç»„ä»¶è®¾è®¡å®Œæ•´ï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†å®Œå–„ |
| è·¯ç”±ç³»ç»Ÿ | 100% | âœ… å®Œæˆ | åŠŸèƒ½å®Œæ•´ï¼Œæ”¯æŒå¤æ‚è·¯ç”±è§„åˆ™ |
| åè®®è½¬æ¢ | 90% | ğŸš§ åŸºæœ¬å®Œæˆ | HTTP è½¬æ¢å®Œæˆï¼Œå…¶ä»–åè®®å¾…å®Œå–„ |
| è¿æ¥ç®¡ç† | 95% | âœ… å®Œæˆ | è¿æ¥æ± å®ç°å®Œæ•´ |
| è¿‡æ»¤å™¨ | 85% | ğŸš§ åŸºæœ¬å®Œæˆ | æ¡†æ¶å®Œæ•´ï¼Œéƒ¨åˆ†è¿‡æ»¤å™¨å¾…å®ç° |
| è´Ÿè½½å‡è¡¡ | 80% | ğŸš§ éƒ¨åˆ†å®Œæˆ | åŸºç¡€ç­–ç•¥å®Œæˆï¼Œé«˜çº§ç­–ç•¥å¾…å®ç° |
| é…ç½®ç³»ç»Ÿ | 95% | âœ… å®Œæˆ | YAML é…ç½®å®Œæ•´ï¼ŒåŠ è½½æœºåˆ¶å®Œå–„ |
| HTTP æœåŠ¡å™¨ | 90% | âœ… åŸºæœ¬å®Œæˆ | åŸºç¡€åŠŸèƒ½å®Œæ•´ï¼ŒHTTPS å¾…å®Œå–„ |

**æ€»ä½“å®Œæˆåº¦ï¼š90%**

`gateway-core-plus` æ¨¡å—å·²ç»å…·å¤‡äº†ä½œä¸ºç”Ÿäº§çº§ç½‘å…³çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œæ¶æ„è®¾è®¡ä¼˜ç§€ï¼Œä»£ç è´¨é‡è¾ƒé«˜ã€‚ä¸»è¦çš„æ ¸å¿ƒåŠŸèƒ½å·²ç»å®ç°ï¼Œå‰©ä½™å·¥ä½œä¸»è¦é›†ä¸­åœ¨é«˜çº§ç‰¹æ€§çš„å®Œå–„å’Œä¸å¤–éƒ¨ç³»ç»Ÿçš„é›†æˆä¸Šã€‚

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
Muxin Gateway æ˜¯ä¸€ä¸ªåŸºäº Netty çš„é«˜æ€§èƒ½ API ç½‘å…³ç³»ç»Ÿï¼Œç®¡ç†ç³»ç»Ÿåç«¯è´Ÿè´£æä¾›ç½‘å…³é…ç½®ç®¡ç†ã€ç›‘æ§æ•°æ®æ”¶é›†ã€ç”¨æˆ·è®¤è¯æˆæƒç­‰åŠŸèƒ½ã€‚æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†ç®¡ç†ç³»ç»Ÿåç«¯çš„è®¾è®¡æ–¹æ¡ˆã€‚

### 1.2 è®¾è®¡ç›®æ ‡
- **é«˜æ€§èƒ½**: æ”¯æŒé«˜å¹¶å‘çš„ç®¡ç†æ“ä½œï¼Œä¸å½±å“ç½‘å…³æ ¸å¿ƒæ€§èƒ½
- **å®‰å…¨æ€§**: å®Œå–„çš„è®¤è¯æˆæƒæœºåˆ¶ï¼Œä¿æŠ¤ç³»ç»Ÿå®‰å…¨
- **å®æ—¶æ€§**: æä¾›å®æ—¶çš„ç›‘æ§æ•°æ®å’Œé…ç½®æ›´æ–°
- **å¯æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
- **æ˜“ç»´æŠ¤**: æ¸…æ™°çš„ä»£ç ç»“æ„å’Œå®Œå–„çš„æ—¥å¿—ç³»ç»Ÿ

### 1.3 æŠ€æœ¯é€‰å‹
- **æ¡†æ¶**: Spring Boot 3.3.5 âœ…
- **æ•°æ®åº“**: MySQL 8.0 + Redis 7.0 âœ…
- **ORM**: MyBatis-Plus 3.5.7 âœ…
- **è®¤è¯**: Spring Security + JWT âŒï¼ˆä½¿ç”¨Sa-Tokenä»£æ›¿ï¼‰
- **æ³¨å†Œä¸­å¿ƒ**: Nacos 2.0+ âœ…
- **å®æ—¶é€šä¿¡**: Spring WebSocket âœ…
- **APIæ–‡æ¡£**: SpringDoc OpenAPI 3.0 âœ…
- **ç¼“å­˜**: Spring Cache + Redis âŒï¼ˆæœªå¯ç”¨ï¼‰
- **ä»»åŠ¡è°ƒåº¦**: Spring Task âŒï¼ˆæœªä½¿ç”¨ï¼‰
- **æ¶ˆæ¯é˜Ÿåˆ—**: é¢„ç•™æ¥å£ï¼ˆKafka/RabbitMQï¼‰âŒ

> **å®ç°çŠ¶æ€è¯´æ˜**ï¼š
> - âœ… è¡¨ç¤ºå·²å®ç°
> - ğŸš§ è¡¨ç¤ºéƒ¨åˆ†å®ç°
> - âŒ è¡¨ç¤ºæœªå®ç°

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å‰ç«¯åº”ç”¨ (Vue 3)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    REST API / WebSocket                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Spring Boot åº”ç”¨å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Controller  â”‚  â”‚   Service   â”‚  â”‚ Repository  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      ä¸­é—´ä»¶å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚    Redis     â”‚  â”‚    MySQL    â”‚  â”‚   Nacos     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—åˆ’åˆ†
```
gateway-admin/
â”œâ”€â”€ src/main/java/com/muxin/gateway/admin/
â”‚   â”œâ”€â”€ config/           # é…ç½®ç±»
â”‚   â”œâ”€â”€ controller/       # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ service/          # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ mapper/           # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ entity/           # å®ä½“ç±»
â”‚   â”œâ”€â”€ dto/              # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ vo/               # è§†å›¾å¯¹è±¡
â”‚   â”œâ”€â”€ enums/            # æšä¸¾ç±»
â”‚   â”œâ”€â”€ exception/        # å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ security/         # å®‰å…¨ç›¸å…³
â”‚   â”œâ”€â”€ websocket/        # WebSocket
â”‚   â”œâ”€â”€ task/             # å®šæ—¶ä»»åŠ¡
â”‚   â”œâ”€â”€ aspect/           # åˆ‡é¢
â”‚   â””â”€â”€ utils/            # å·¥å…·ç±»
â””â”€â”€ src/main/resources/
    â”œâ”€â”€ mapper/           # MyBatisæ˜ å°„æ–‡ä»¶
    â”œâ”€â”€ static/           # é™æ€èµ„æº
    â””â”€â”€ application.yml   # é…ç½®æ–‡ä»¶
```

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 ç”¨æˆ·ç®¡ç†ç›¸å…³è¡¨

#### 3.1.1 sys_userï¼ˆç”¨æˆ·è¡¨ï¼‰
```sql
CREATE TABLE `sys_user` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `password` varchar(100) NOT NULL COMMENT 'å¯†ç ',
  `nickname` varchar(50) DEFAULT NULL COMMENT 'æ˜µç§°',
  `email` varchar(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `phone` varchar(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `avatar` varchar(500) DEFAULT NULL COMMENT 'å¤´åƒURL',
  `gender` tinyint DEFAULT '0' COMMENT 'æ€§åˆ«ï¼š0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-æ­£å¸¸',
  `dept_id` bigint DEFAULT NULL COMMENT 'éƒ¨é—¨ID',
  `login_ip` varchar(50) DEFAULT NULL COMMENT 'æœ€åç™»å½•IP',
  `login_time` datetime DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
  `login_attempts` int DEFAULT '0' COMMENT 'ç™»å½•å¤±è´¥æ¬¡æ•°',
  `locked_time` datetime DEFAULT NULL COMMENT 'é”å®šæ—¶é—´',
  `password_reset_time` datetime DEFAULT NULL COMMENT 'å¯†ç é‡ç½®æ—¶é—´',
  `create_by` varchar(50) DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(50) DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted` tinyint DEFAULT '0' COMMENT 'åˆ é™¤æ ‡è®°ï¼š0-æ­£å¸¸ï¼Œ1-åˆ é™¤',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_username` (`username`),
  KEY `idx_email` (`email`),
  KEY `idx_phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

#### 3.1.2 sys_roleï¼ˆè§’è‰²è¡¨ï¼‰
```sql
CREATE TABLE `sys_role` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'è§’è‰²ID',
  `role_code` varchar(50) NOT NULL COMMENT 'è§’è‰²ç¼–ç ',
  `role_name` varchar(50) NOT NULL COMMENT 'è§’è‰²åç§°',
  `description` varchar(500) DEFAULT NULL COMMENT 'æè¿°',
  `sort` int DEFAULT '0' COMMENT 'æ’åº',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-æ­£å¸¸',
  `create_by` varchar(50) DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(50) DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted` tinyint DEFAULT '0' COMMENT 'åˆ é™¤æ ‡è®°',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_role_code` (`role_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²è¡¨';
```

#### 3.1.3 sys_permissionï¼ˆæƒé™è¡¨ï¼‰
```sql
CREATE TABLE `sys_permission` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'æƒé™ID',
  `parent_id` bigint DEFAULT '0' COMMENT 'çˆ¶çº§ID',
  `perm_type` varchar(20) NOT NULL COMMENT 'æƒé™ç±»å‹ï¼šmenu-èœå•ï¼Œbutton-æŒ‰é’®ï¼Œapi-æ¥å£',
  `perm_code` varchar(100) NOT NULL COMMENT 'æƒé™ç¼–ç ',
  `perm_name` varchar(50) NOT NULL COMMENT 'æƒé™åç§°',
  `path` varchar(200) DEFAULT NULL COMMENT 'è·¯å¾„',
  `component` varchar(200) DEFAULT NULL COMMENT 'ç»„ä»¶è·¯å¾„',
  `icon` varchar(50) DEFAULT NULL COMMENT 'å›¾æ ‡',
  `sort` int DEFAULT '0' COMMENT 'æ’åº',
  `visible` tinyint DEFAULT '1' COMMENT 'æ˜¯å¦å¯è§',
  `status` tinyint DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-æ­£å¸¸',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_perm_code` (`perm_code`),
  KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æƒé™è¡¨';
```

#### 3.1.4 sys_user_roleï¼ˆç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼‰
```sql
CREATE TABLE `sys_user_role` (
  `user_id` bigint NOT NULL COMMENT 'ç”¨æˆ·ID',
  `role_id` bigint NOT NULL COMMENT 'è§’è‰²ID',
  PRIMARY KEY (`user_id`,`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

#### 3.1.5 sys_role_permissionï¼ˆè§’è‰²æƒé™å…³è”è¡¨ï¼‰
```sql
CREATE TABLE `sys_role_permission` (
  `role_id` bigint NOT NULL COMMENT 'è§’è‰²ID',
  `permission_id` bigint NOT NULL COMMENT 'æƒé™ID',
  PRIMARY KEY (`role_id`,`permission_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²æƒé™å…³è”è¡¨';
```

### 3.2 ç½‘å…³é…ç½®ç›¸å…³è¡¨

#### 3.2.1 gateway_routeï¼ˆè·¯ç”±é…ç½®è¡¨ï¼‰
```sql
CREATE TABLE `gateway_route` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `route_id` varchar(100) NOT NULL COMMENT 'è·¯ç”±ID',
  `route_name` varchar(100) NOT NULL COMMENT 'è·¯ç”±åç§°',
  `description` varchar(500) DEFAULT NULL COMMENT 'æè¿°',
  `uri` varchar(500) NOT NULL COMMENT 'ç›®æ ‡URI',
  `predicates` json DEFAULT NULL COMMENT 'æ–­è¨€é…ç½®',
  `filters` json DEFAULT NULL COMMENT 'è¿‡æ»¤å™¨é…ç½®',
  `metadata` json DEFAULT NULL COMMENT 'å…ƒæ•°æ®',
  `route_order` int DEFAULT '0' COMMENT 'è·¯ç”±é¡ºåº',
  `enabled` tinyint DEFAULT '1' COMMENT 'æ˜¯å¦å¯ç”¨',
  `grayscale_enabled` tinyint DEFAULT '0' COMMENT 'æ˜¯å¦å¼€å¯ç°åº¦',
  `grayscale_config` json DEFAULT NULL COMMENT 'ç°åº¦é…ç½®',
  `template_id` bigint DEFAULT NULL COMMENT 'æ¨¡æ¿ID',
  `version` int DEFAULT '1' COMMENT 'ç‰ˆæœ¬å·',
  `create_by` varchar(50) DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(50) DEFAULT NULL COMMENT 'æ›´æ–°è€…',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_route_id` (`route_id`),
  KEY `idx_enabled` (`enabled`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è·¯ç”±é…ç½®è¡¨';
```

#### 3.2.2 gateway_service_nodeï¼ˆæœåŠ¡èŠ‚ç‚¹è¡¨ï¼‰
```sql
CREATE TABLE `gateway_service_node` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `service_id` varchar(100) NOT NULL COMMENT 'æœåŠ¡ID',
  `node_id` varchar(100) NOT NULL COMMENT 'èŠ‚ç‚¹ID',
  `address` varchar(200) NOT NULL COMMENT 'èŠ‚ç‚¹åœ°å€',
  `port` int NOT NULL COMMENT 'ç«¯å£',
  `weight` int DEFAULT '100' COMMENT 'æƒé‡',
  `status` varchar(20) DEFAULT 'UP' COMMENT 'çŠ¶æ€ï¼šUP-æ­£å¸¸ï¼ŒDOWN-ä¸‹çº¿',
  `health_check_url` varchar(500) DEFAULT NULL COMMENT 'å¥åº·æ£€æŸ¥URL',
  `last_heartbeat` datetime DEFAULT NULL COMMENT 'æœ€åå¿ƒè·³æ—¶é—´',
  `metadata` json DEFAULT NULL COMMENT 'å…ƒæ•°æ®',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_node_id` (`node_id`),
  KEY `idx_service_id` (`service_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æœåŠ¡èŠ‚ç‚¹è¡¨';
```

#### 3.2.3 gateway_route_templateï¼ˆè·¯ç”±æ¨¡æ¿è¡¨ï¼‰
```sql
CREATE TABLE `gateway_route_template` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `template_name` varchar(100) NOT NULL COMMENT 'æ¨¡æ¿åç§°',
  `description` varchar(500) DEFAULT NULL COMMENT 'æè¿°',
  `category` varchar(50) DEFAULT NULL COMMENT 'åˆ†ç±»',
  `config` json NOT NULL COMMENT 'é…ç½®å†…å®¹',
  `variables` json DEFAULT NULL COMMENT 'æ¨¡æ¿å˜é‡',
  `is_system` tinyint DEFAULT '0' COMMENT 'æ˜¯å¦ç³»ç»Ÿå†…ç½®',
  `usage_count` int DEFAULT '0' COMMENT 'ä½¿ç”¨æ¬¡æ•°',
  `create_by` varchar(50) DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_category` (`category`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è·¯ç”±æ¨¡æ¿è¡¨';
```

### 3.3 ç›‘æ§ç›¸å…³è¡¨

#### 3.3.1 gateway_access_logï¼ˆè®¿é—®æ—¥å¿—è¡¨ï¼‰
```sql
CREATE TABLE `gateway_access_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `request_id` varchar(50) NOT NULL COMMENT 'è¯·æ±‚ID',
  `route_id` varchar(100) DEFAULT NULL COMMENT 'è·¯ç”±ID',
  `request_method` varchar(10) DEFAULT NULL COMMENT 'è¯·æ±‚æ–¹æ³•',
  `request_uri` varchar(500) DEFAULT NULL COMMENT 'è¯·æ±‚URI',
  `query_params` text DEFAULT NULL COMMENT 'æŸ¥è¯¢å‚æ•°',
  `request_headers` json DEFAULT NULL COMMENT 'è¯·æ±‚å¤´',
  `request_body` text DEFAULT NULL COMMENT 'è¯·æ±‚ä½“',
  `client_ip` varchar(50) DEFAULT NULL COMMENT 'å®¢æˆ·ç«¯IP',
  `user_agent` varchar(500) DEFAULT NULL COMMENT 'User-Agent',
  `response_status` int DEFAULT NULL COMMENT 'å“åº”çŠ¶æ€ç ',
  `response_headers` json DEFAULT NULL COMMENT 'å“åº”å¤´',
  `response_body` text DEFAULT NULL COMMENT 'å“åº”ä½“',
  `response_time` bigint DEFAULT NULL COMMENT 'å“åº”æ—¶é—´(ms)',
  `error_message` text DEFAULT NULL COMMENT 'é”™è¯¯ä¿¡æ¯',
  `access_time` datetime NOT NULL COMMENT 'è®¿é—®æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_request_id` (`request_id`),
  KEY `idx_route_id` (`route_id`),
  KEY `idx_access_time` (`access_time`),
  KEY `idx_response_status` (`response_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¿é—®æ—¥å¿—è¡¨'
PARTITION BY RANGE (TO_DAYS(access_time)) (
  PARTITION p0 VALUES LESS THAN (TO_DAYS('2024-01-01')),
  PARTITION p1 VALUES LESS THAN (TO_DAYS('2024-02-01')),
  PARTITION p2 VALUES LESS THAN (TO_DAYS('2024-03-01'))
);
```

#### 3.3.2 gateway_metricsï¼ˆç›‘æ§æŒ‡æ ‡è¡¨ï¼‰
```sql
CREATE TABLE `gateway_metrics` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `metric_type` varchar(50) NOT NULL COMMENT 'æŒ‡æ ‡ç±»å‹',
  `metric_name` varchar(100) NOT NULL COMMENT 'æŒ‡æ ‡åç§°',
  `metric_value` decimal(20,4) NOT NULL COMMENT 'æŒ‡æ ‡å€¼',
  `tags` json DEFAULT NULL COMMENT 'æ ‡ç­¾',
  `timestamp` datetime NOT NULL COMMENT 'æ—¶é—´æˆ³',
  PRIMARY KEY (`id`),
  KEY `idx_metric_type` (`metric_type`),
  KEY `idx_timestamp` (`timestamp`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç›‘æ§æŒ‡æ ‡è¡¨';
```

### 3.4 ç³»ç»Ÿç®¡ç†ç›¸å…³è¡¨

#### 3.4.1 sys_operation_logï¼ˆæ“ä½œæ—¥å¿—è¡¨ï¼‰
```sql
CREATE TABLE `sys_operation_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `module` varchar(50) DEFAULT NULL COMMENT 'æ¨¡å—',
  `operation` varchar(50) DEFAULT NULL COMMENT 'æ“ä½œ',
  `method` varchar(200) DEFAULT NULL COMMENT 'æ–¹æ³•',
  `params` text DEFAULT NULL COMMENT 'å‚æ•°',
  `result` text DEFAULT NULL COMMENT 'ç»“æœ',
  `error` text DEFAULT NULL COMMENT 'é”™è¯¯ä¿¡æ¯',
  `duration` bigint DEFAULT NULL COMMENT 'è€—æ—¶(ms)',
  `operator` varchar(50) DEFAULT NULL COMMENT 'æ“ä½œäºº',
  `operator_ip` varchar(50) DEFAULT NULL COMMENT 'æ“ä½œIP',
  `operate_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'æ“ä½œæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_module` (`module`),
  KEY `idx_operator` (`operator`),
  KEY `idx_operate_time` (`operate_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ“ä½œæ—¥å¿—è¡¨';
```

#### 3.4.2 sys_login_logï¼ˆç™»å½•æ—¥å¿—è¡¨ï¼‰
```sql
CREATE TABLE `sys_login_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `login_type` varchar(20) DEFAULT NULL COMMENT 'ç™»å½•ç±»å‹',
  `login_ip` varchar(50) DEFAULT NULL COMMENT 'ç™»å½•IP',
  `login_location` varchar(100) DEFAULT NULL COMMENT 'ç™»å½•åœ°ç‚¹',
  `browser` varchar(100) DEFAULT NULL COMMENT 'æµè§ˆå™¨',
  `os` varchar(100) DEFAULT NULL COMMENT 'æ“ä½œç³»ç»Ÿ',
  `status` tinyint DEFAULT NULL COMMENT 'çŠ¶æ€ï¼š0-å¤±è´¥ï¼Œ1-æˆåŠŸ',
  `message` varchar(500) DEFAULT NULL COMMENT 'æ¶ˆæ¯',
  `login_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'ç™»å½•æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_username` (`username`),
  KEY `idx_status` (`status`),
  KEY `idx_login_time` (`login_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç™»å½•æ—¥å¿—è¡¨';
```

## 4. APIæ¥å£è®¾è®¡

### 4.1 è®¤è¯æ¥å£

#### 4.1.1 ç”¨æˆ·ç™»å½•
```yaml
POST /api/auth/login
Request:
  {
    "username": "string",
    "password": "string",
    "captcha": "string",      # éªŒè¯ç ï¼ˆå¯é€‰ï¼‰
    "captchaId": "string"     # éªŒè¯ç IDï¼ˆå¯é€‰ï¼‰
  }
Response:
  {
    "code": 200,
    "message": "success",
    "data": {
      "token": "string",
      "refreshToken": "string",
      "tokenType": "Bearer",
      "expiresIn": 7200,
      "userInfo": {
        "id": 1,
        "username": "admin",
        "nickname": "ç®¡ç†å‘˜",
        "avatar": "string",
        "roles": ["admin"],
        "permissions": ["sys:user:list", "sys:user:add"]
      }
    }
  }
```

#### 4.1.2 åˆ·æ–°Token
```yaml
POST /api/auth/refresh
Request:
  {
    "refreshToken": "string"
  }
Response:
  {
    "code": 200,
    "data": {
      "token": "string",
      "refreshToken": "string",
      "expiresIn": 7200
    }
  }
```

#### 4.1.3 è·å–éªŒè¯ç 
```yaml
GET /api/auth/captcha/generate
Response:
  {
    "code": 200,
    "data": {
      "captchaId": "string",
      "captchaImage": "base64_string"
    }
  }
```

### 4.2 ç›‘æ§æ¥å£

#### 4.2.1 å®æ—¶ç»Ÿè®¡WebSocket
```yaml
WS /ws/monitor
Message Format:
  {
    "type": "stats",
    "data": {
      "timestamp": 1704985200000,
      "metrics": {
        "qps": 1234,
        "totalRequests": 567890,
        "avgResponseTime": 45.6,
        "errorRate": 0.12,
        "activeConnections": 234
      },
      "statusCodeDistribution": {
        "2xx": 5000,
        "3xx": 100,
        "4xx": 50,
        "5xx": 10
      }
    }
  }
```

#### 4.2.2 è·¯ç”±ç›‘æ§æ•°æ®
```yaml
GET /api/monitor/routes
Parameters:
  - timeRange: string (1h, 6h, 24h, 7d)
  - routeId: string (optional)
Response:
  {
    "code": 200,
    "data": {
      "routes": [{
        "routeId": "user-service",
        "routeName": "ç”¨æˆ·æœåŠ¡",
        "callCount": 12345,
        "avgResponseTime": 123,
        "p95ResponseTime": 456,
        "p99ResponseTime": 789,
        "errorCount": 12,
        "errorRate": 0.1
      }]
    }
  }
```

### 4.3 è·¯ç”±ç®¡ç†æ¥å£

#### 4.3.1 è·å–è·¯ç”±åˆ—è¡¨
```yaml
GET /api/routes
Parameters:
  - page: int
  - size: int
  - keyword: string
  - enabled: boolean
Response:
  {
    "code": 200,
    "data": {
      "total": 100,
      "list": [{
        "id": 1,
        "routeId": "user-service",
        "routeName": "ç”¨æˆ·æœåŠ¡",
        "uri": "lb://user-service",
        "predicates": [...],
        "filters": [...],
        "enabled": true,
        "createTime": "2024-01-01 00:00:00"
      }]
    }
  }
```

#### 4.3.2 åˆ›å»ºè·¯ç”±
```yaml
POST /api/routes
Request:
  {
    "routeId": "string",
    "routeName": "string",
    "uri": "string",
    "predicates": [{
      "name": "Path",
      "args": {
        "pattern": "/api/users/**"
      }
    }],
    "filters": [{
      "name": "StripPrefix",
      "args": {
        "parts": 1
      }
    }],
    "order": 0,
    "enabled": true
  }
```

### 4.4 ç”¨æˆ·ç®¡ç†æ¥å£

#### 4.4.1 è·å–ç”¨æˆ·åˆ—è¡¨
```yaml
GET /api/system/users
Parameters:
  - page: int
  - size: int
  - keyword: string
  - deptId: long
  - status: int
Response:
  {
    "code": 200,
    "data": {
      "total": 100,
      "list": [{
        "id": 1,
        "username": "admin",
        "nickname": "ç®¡ç†å‘˜",
        "email": "admin@example.com",
        "roles": [{
          "id": 1,
          "roleName": "ç®¡ç†å‘˜"
        }],
        "status": 1,
        "createTime": "2024-01-01 00:00:00"
      }]
    }
  }
```

## 5. æ ¸å¿ƒåŠŸèƒ½å®ç°

### 5.1 JWTè®¤è¯å®ç° âŒï¼ˆä½¿ç”¨Sa-Tokenä»£æ›¿ï¼‰

#### 5.1.1 JWTå·¥å…·ç±»
```java
// é¡¹ç›®ä½¿ç”¨Sa-Tokenè¿›è¡Œè®¤è¯ï¼Œæœªä½¿ç”¨JWT
// Sa-Tokené…ç½®è§ï¼šSaTokenConfig.java
```

#### 5.1.2 JWTè®¤è¯è¿‡æ»¤å™¨
```java
// ä½¿ç”¨Sa-Tokençš„è®¤è¯æ‹¦æˆªå™¨
// è§ï¼šSaTokenConfig.javaä¸­çš„æ‹¦æˆªå™¨é…ç½®
```

å®é™…å®ç°çŠ¶æ€ï¼š
- âœ… ä½¿ç”¨Sa-Tokenè¿›è¡Œä¼šè¯ç®¡ç†
- âœ… æ”¯æŒç™»å½•ã€ç™»å‡ºã€æƒé™éªŒè¯
- âŒ æœªå®ç°JWT Token
- âŒ æœªå®ç°Tokenè‡ªåŠ¨åˆ·æ–°ï¼ˆSa-Tokenä¼šè¯æœ‰æ•ˆæœŸç®¡ç†ï¼‰

### 5.2 WebSocketå®æ—¶ç›‘æ§ ğŸš§

#### 5.2.1 WebSocketé…ç½® âœ…
```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    // å·²å®ç°
}
```

#### 5.2.2 ç›‘æ§æ•°æ®æ¨é€ ğŸš§
```java
@Component
public class MonitorWebSocketHandler extends TextWebSocketHandler {
    // æ¡†æ¶å·²å®ç°ï¼Œä½†æœªé›†æˆå®é™…ç›‘æ§æ•°æ®
    // ç¼ºå°‘å®šæ—¶æ¨é€æœºåˆ¶
}
```

å®é™…å®ç°çŠ¶æ€ï¼š
- âœ… WebSocketè¿æ¥ç®¡ç†
- âœ… æ¶ˆæ¯å‘é€æœºåˆ¶
- âŒ å®æ—¶ç›‘æ§æ•°æ®æ”¶é›†
- âŒ å®šæ—¶æ•°æ®æ¨é€
- âŒ ä¸ç½‘å…³æ ¸å¿ƒçš„æ•°æ®é›†æˆ

### 5.3 è·¯ç”±é…ç½®çƒ­æ›´æ–° âŒ

#### 5.3.1 è·¯ç”±åˆ·æ–°äº‹ä»¶
```java
// æœªå®ç°
// è·¯ç”±æ›´æ–°éœ€è¦é‡å¯ç½‘å…³ç”Ÿæ•ˆ
```

å®é™…å®ç°çŠ¶æ€ï¼š
- âœ… è·¯ç”±é…ç½®CRUD API
- âŒ çƒ­æ›´æ–°æœºåˆ¶
- âŒ é…ç½®å˜æ›´é€šçŸ¥
- âŒ æ— åœæœºæ›´æ–°

### 5.4 åˆ†å¸ƒå¼é™æµ âŒ

#### 5.4.1 Redisé™æµå®ç°
```java
// æœªå®ç°
// å½“å‰æ— é™æµåŠŸèƒ½
```

å®é™…å®ç°çŠ¶æ€ï¼š
- âŒ Redisé™æµå™¨
- âŒ é™æµè§„åˆ™é…ç½®
- âŒ é™æµç»Ÿè®¡

## 6. å®‰å…¨è®¾è®¡

### 6.1 è®¤è¯æˆæƒ
- JWT Tokenè®¤è¯ âŒï¼ˆä½¿ç”¨Sa-Tokenï¼‰
- è§’è‰²æƒé™æ§åˆ¶ï¼ˆRBACï¼‰âœ…ï¼ˆæƒé™éªŒè¯æš‚æ—¶ç¦ç”¨ï¼‰
- æ¥å£æƒé™æ ¡éªŒ âŒï¼ˆå·²ç¦ç”¨ï¼‰
- æ•°æ®æƒé™éš”ç¦» âŒ

### 6.2 å®‰å…¨é˜²æŠ¤
- SQLæ³¨å…¥é˜²æŠ¤ï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰âœ…
- XSSé˜²æŠ¤ï¼ˆè¾“å…¥è¾“å‡ºè¿‡æ»¤ï¼‰âŒ
- CSRFé˜²æŠ¤ï¼ˆTokenéªŒè¯ï¼‰âŒï¼ˆSa-Tokenè‡ªå¸¦ï¼‰
- æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨ âœ…ï¼ˆå¯†ç BCryptåŠ å¯†ï¼‰
- æ¥å£é˜²é‡æ”¾æ”»å‡» âŒ
- é™æµé˜²æŠ¤ âŒ

### 6.3 å®¡è®¡æ—¥å¿—
- æ“ä½œæ—¥å¿—è®°å½• ğŸš§ï¼ˆåŸºç¡€å®ç°ï¼‰
- ç™»å½•æ—¥å¿—è®°å½• ğŸš§ï¼ˆåŸºç¡€å®ç°ï¼‰
- å¼‚å¸¸è¡Œä¸ºç›‘æ§ âŒ
- æ•æ„Ÿæ“ä½œå‘Šè­¦ âŒ

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 ç¼“å­˜ç­–ç•¥ âŒ
```java
// ç¼“å­˜é…ç½®å·²å®šä¹‰ä½†æœªå¯ç”¨
@Configuration
@EnableCaching
public class CacheConfig {
    // æœªå®é™…ä½¿ç”¨
}
```

### 7.2 æ•°æ®åº“ä¼˜åŒ–
- ç´¢å¼•ä¼˜åŒ– âœ…
- åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ– âœ…
- æ‰¹é‡æ“ä½œ âŒ
- è¯»å†™åˆ†ç¦»ï¼ˆé¢„ç•™ï¼‰âŒ
- åˆ†åº“åˆ†è¡¨ï¼ˆé¢„ç•™ï¼‰âŒ

### 7.3 å¼‚æ­¥å¤„ç† âŒ
```java
// å¼‚æ­¥é…ç½®å·²å®šä¹‰ä½†æœªä½¿ç”¨
@Configuration
@EnableAsync
public class AsyncConfig {
    // æœªå®é™…ä½¿ç”¨
}
```

## 8. éƒ¨ç½²é…ç½®

### 8.1 åº”ç”¨é…ç½®
```yaml
spring:
  application:
    name: gateway-admin
  
  datasource:
    url: jdbc:mysql://localhost:3306/gateway_admin?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: root
    password: ${DB_PASSWORD:root}
    driver-class-name: com.mysql.cj.jdbc.Driver
    
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: 0
    
  cache:
    type: redis
    
mybatis-plus:
  mapper-locations: classpath*:mapper/**/*.xml
  configuration:
    map-underscore-to-camel-case: true
    
jwt:
  secret: ${JWT_SECRET:muxin-gateway-secret-key}
  expiration: 7200      # 2å°æ—¶
  refresh-expiration: 604800  # 7å¤©
  
server:
  port: 8080
```

### 8.2 ç”Ÿäº§ç¯å¢ƒé…ç½®
```yaml
# application-prod.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      
  redis:
    lettuce:
      pool:
        max-active: 20
        max-idle: 10
        min-idle: 5
        
logging:
  level:
    com.muxin: INFO
    org.springframework: WARN
    
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
```

## 9. ç›‘æ§å‘Šè­¦

### 9.1 å¥åº·æ£€æŸ¥ âŒ
```java
// æœªå®ç°è‡ªå®šä¹‰å¥åº·æ£€æŸ¥
// ä»…ä½¿ç”¨Spring Booté»˜è®¤å¥åº·æ£€æŸ¥
```

### 9.2 æŒ‡æ ‡æ”¶é›†
- QPSç›‘æ§ ğŸš§ï¼ˆæ•°æ®åº“è®°å½•ï¼Œæœªå®æ—¶æ¨é€ï¼‰
- å“åº”æ—¶é—´ç›‘æ§ ğŸš§ï¼ˆæ•°æ®åº“è®°å½•ï¼‰
- é”™è¯¯ç‡ç›‘æ§ ğŸš§ï¼ˆæ•°æ®åº“è®°å½•ï¼‰
- JVMç›‘æ§ âŒ
- æ•°æ®åº“è¿æ¥æ± ç›‘æ§ âŒ

### 9.3 å‘Šè­¦è§„åˆ™
- æœåŠ¡ä¸å¯ç”¨å‘Šè­¦ âŒ
- é”™è¯¯ç‡è¶…é˜ˆå€¼å‘Šè­¦ âŒ
- å“åº”æ—¶é—´è¶…é˜ˆå€¼å‘Šè­¦ âŒ
- èµ„æºä½¿ç”¨ç‡å‘Šè­¦ âŒ

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•
```java
@SpringBootTest
class UserServiceTest {
    
    @MockBean
    private UserMapper userMapper;
    
    @Autowired
    private UserService userService;
    
    @Test
    void testLogin() {
        // Given
        User user = new User();
        user.setUsername("admin");
        user.setPassword("encoded_password");
        
        when(userMapper.selectByUsername("admin")).thenReturn(user);
        
        // When
        LoginResponse response = userService.login("admin", "password");
        
        // Then
        assertNotNull(response);
        assertNotNull(response.getToken());
    }
}
```

### 10.2 é›†æˆæµ‹è¯•
```java
@SpringBootTest
@AutoConfigureMockMvc
class AuthControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    void testLoginApi() throws Exception {
        LoginRequest request = new LoginRequest();
        request.setUsername("admin");
        request.setPassword("admin123");
        
        mockMvc.perform(post("/api/auth/login")
                .contentType(MediaType.APPLICATION_JSON)
                .content(JsonUtils.toJson(request)))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.code").value(200))
                .andExpect(jsonPath("$.data.token").exists());
    }
}
```

## 11. å¼€å‘è§„èŒƒ

### 11.1 ä»£ç è§„èŒƒ
- éµå¾ªé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ
- ä½¿ç”¨Lombokå‡å°‘æ ·æ¿ä»£ç 
- ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†
- ç»Ÿä¸€çš„å“åº”æ ¼å¼
- å®Œå–„çš„æ³¨é‡Šæ–‡æ¡£

### 11.2 Gitè§„èŒƒ
- åˆ†æ”¯ç®¡ç†ï¼šmain/develop/feature/hotfix
- æäº¤ä¿¡æ¯ï¼šfeat/fix/docs/style/refactor/test/chore
- ä»£ç å®¡æŸ¥ï¼šPRéœ€è¦è‡³å°‘ä¸€äººå®¡æ ¸

### 11.3 APIè§„èŒƒ
- RESTfulé£æ ¼
- ç»Ÿä¸€çš„URLå‘½å
- ç‰ˆæœ¬ç®¡ç†
- å®Œå–„çš„APIæ–‡æ¡£

## 12. æ‰©å±•æ€§è®¾è®¡

### 12.1 æ’ä»¶åŒ–æ¶æ„
- SPIæœºåˆ¶æ”¯æŒè‡ªå®šä¹‰è¿‡æ»¤å™¨ âœ…ï¼ˆç½‘å…³æ ¸å¿ƒæ”¯æŒï¼‰
- äº‹ä»¶é©±åŠ¨çš„æ‰©å±•ç‚¹ âŒ
- ç­–ç•¥æ¨¡å¼çš„ç®—æ³•æ‰©å±• âœ…ï¼ˆè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰

### 12.2 å¾®æœåŠ¡åŒ–å‡†å¤‡
- æœåŠ¡æ‹†åˆ†é¢„ç•™ âœ…ï¼ˆæ¨¡å—åŒ–è®¾è®¡ï¼‰
- åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ âŒ
- æœåŠ¡æ³¨å†Œå‘ç° âœ…ï¼ˆNacosé›†æˆï¼‰

## 13. é—®é¢˜ä¸é£é™©

### 13.1 æŠ€æœ¯é£é™©
- é«˜å¹¶å‘ä¸‹çš„æ€§èƒ½é—®é¢˜
- åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜
- å®‰å…¨æ¼æ´é£é™©

### 13.2 ç¼“è§£æªæ–½
- æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- åˆ†å¸ƒå¼é”å’Œäº‹åŠ¡
- å®‰å…¨å®¡è®¡å’Œæ¸—é€æµ‹è¯•

## 14. æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†Muxin Gatewayç®¡ç†ç³»ç»Ÿåç«¯çš„è®¾è®¡æ–¹æ¡ˆï¼Œæ¶µç›–äº†æ¶æ„è®¾è®¡ã€æ•°æ®åº“è®¾è®¡ã€æ¥å£è®¾è®¡ã€æ ¸å¿ƒåŠŸèƒ½å®ç°ã€å®‰å…¨è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ç­‰æ–¹é¢ã€‚ç³»ç»Ÿé‡‡ç”¨Spring Boot 3.xæ¡†æ¶ï¼Œç»“åˆMyBatis-Plusã€Spring Securityã€Redisç­‰æŠ€æœ¯æ ˆï¼Œæä¾›äº†å®Œå–„çš„ç½‘å…³ç®¡ç†åŠŸèƒ½ã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œè§„èŒƒçš„å¼€å‘æµç¨‹ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚ 