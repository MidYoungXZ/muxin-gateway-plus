# Muxin Gateway 管理系统前端设计文档

## 1. 项目概述

### 1.1 项目背景
Muxin Gateway是一个高性能的API网关系统，需要一个功能完善、用户友好的管理界面来配置和监控网关的运行状态。本文档定义了管理系统前端的详细设计方案。

### 1.2 设计目标
- **易用性**: 直观的用户界面，降低学习成本
- **实时性**: 实时展示网关运行状态和监控数据
- **可扩展**: 模块化设计，便于功能扩展
- **高性能**: 优化加载速度和运行性能
- **国际化**: 支持中英文切换

### 1.3 技术选型理由
- **Vue 3**: 性能优秀，Composition API提供更好的逻辑复用 ✅
- **Element Plus**: 成熟的企业级组件库，与Vue 3完美配合 ✅
- **TypeScript**: 类型安全，提高代码质量和可维护性 ❌（未使用）
- **Vite**: 极速的开发体验，优秀的打包性能 ✅
- **ECharts**: 功能丰富的图表库，满足监控可视化需求 ✅

> **实现状态说明**：
> - ✅ 表示已实现
> - 🚧 表示部分实现
> - ❌ 表示未实现

## 2. 系统架构设计

### 2.1 整体架构
```
┌─────────────────────────────────────────────────────────────┐
│                         浏览器端                              │
├─────────────────────────────────────────────────────────────┤
│  Vue 3 + Element Plus + TypeScript + ECharts + WebSocket    │
├─────────────────────────────────────────────────────────────┤
│                    Axios HTTP Client                         │
└──────────────────────┬──────────────────────────────────────┘
                       │ HTTPS/WSS
┌──────────────────────┴──────────────────────────────────────┐
│                    Spring Boot Backend                       │
│  ┌────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │   静态资源   │  │   REST API    │  │  WebSocket   │       │
│  └────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 前端分层架构
```
表现层 (Views)
    ↓
路由层 (Router)
    ↓
状态管理层 (Stores)
    ↓
服务层 (API/Services)
    ↓
网络层 (Axios/WebSocket)
```

### 2.3 模块划分
```
前端应用
├── 公共模块
│   ├── 布局组件
│   ├── 通用组件
│   ├── 工具函数
│   └── 样式主题
├── 认证模块
│   ├── 登录页面
│   ├── 注册页面
│   ├── 忘记密码
│   ├── 权限控制
│   └── Token管理
├── 监控模块
│   ├── 实时统计
│   ├── 路由监控
│   └── 过滤器监控
├── 路由模块
│   ├── 路由配置
│   ├── 节点管理
│   ├── 负载均衡
│   ├── 过滤器链
│   └── 配置模板
├── 鉴权模块
│   ├── API权限
│   └── 白名单
└── 系统模块
    ├── 用户管理
    ├── 角色权限
    ├── 部门组织
    ├── 操作日志
    └── 系统配置
```

## 3. 功能详细设计

### 3.1 认证模块

#### 3.1.1 登录页面 ✅
```typescript
// 登录表单接口
interface LoginForm {
  username: string;
  password: string;
  captcha: string;     // ❌ 验证码未实现
  captchaId: string;   // ❌ 验证码未实现
  rememberMe: boolean; // ❌ 记住我未实现
}

// 页面设计要点
- 简洁美观的登录界面，突出品牌Logo ✅
- 支持用户名/邮箱/手机号登录 ❌（仅用户名）
- 图形验证码（登录失败3次后显示）❌
- 记住用户名功能 ❌
- 密码显示/隐藏切换 ✅
- 登录加载状态展示 ✅
- 错误信息友好提示 ✅
- 快速跳转注册/忘记密码 ❌（无注册和忘记密码）

// 登录页面布局
<template>
  <div class="login-container">
    <div class="login-box">
      <div class="login-header">
        <img src="/logo.svg" alt="Logo">
        <h1>Muxin Gateway</h1>
      </div>
      <el-form ref="loginForm" :model="form" :rules="rules">
        <el-form-item prop="username">
          <el-input 
            v-model="form.username" 
            placeholder="用户名/邮箱/手机号"
            prefix-icon="User"
          />
        </el-form-item>
        <el-form-item prop="password">
          <el-input 
            v-model="form.password" 
            type="password"
            placeholder="密码"
            prefix-icon="Lock"
            show-password
          />
        </el-form-item>
        <el-form-item v-if="showCaptcha" prop="captcha">
          <el-row :gutter="10">
            <el-col :span="16">
              <el-input v-model="form.captcha" placeholder="验证码"/>
            </el-col>
            <el-col :span="8">
              <img :src="captchaUrl" @click="refreshCaptcha">
            </el-col>
          </el-row>
        </el-form-item>
        <el-form-item>
          <el-checkbox v-model="form.rememberMe">记住用户名</el-checkbox>
          <el-link style="float: right" @click="toForgotPassword">忘记密码？</el-link>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" :loading="loading" @click="handleLogin" style="width: 100%">
            登录
          </el-button>
        </el-form-item>
        <el-form-item>
          <span>还没有账号？</span>
          <el-link @click="toRegister">立即注册</el-link>
        </el-form-item>
      </el-form>
    </div>
  </div>
</template>
```

#### 3.1.2 注册页面 ❌
```typescript
// 注册表单接口
interface RegisterForm {
  username: string;
  password: string;
  confirmPassword: string;
  email: string;
  phone?: string;
  captcha: string;
  emailCode?: string;     // 邮箱验证码
  agreement: boolean;
}

// 页面设计要点
- 分步注册流程（基本信息 -> 邮箱验证 -> 完成）
- 实时表单验证
- 密码强度提示
- 用户名实时可用性检查
- 邮箱/手机验证码发送
- 用户协议和隐私政策展示
- 注册成功自动跳转登录

// 注册表单验证规则
const rules = {
  username: [
    { required: true, message: '请输入用户名' },
    { min: 4, max: 20, message: '用户名长度在4-20个字符' },
    { pattern: /^[a-zA-Z0-9_]+$/, message: '用户名只能包含字母、数字和下划线' },
    { validator: checkUsernameAvailable, trigger: 'blur' }
  ],
  password: [
    { required: true, message: '请输入密码' },
    { min: 8, max: 20, message: '密码长度在8-20个字符' },
    { validator: checkPasswordStrength, trigger: 'change' }
  ],
  confirmPassword: [
    { required: true, message: '请再次输入密码' },
    { validator: checkPasswordMatch, trigger: 'blur' }
  ],
  email: [
    { required: true, message: '请输入邮箱' },
    { type: 'email', message: '请输入正确的邮箱格式' }
  ],
  emailCode: [
    { required: true, message: '请输入邮箱验证码' },
    { len: 6, message: '验证码为6位数字' }
  ],
  agreement: [
    { validator: (rule, value) => value === true, message: '请同意用户协议' }
  ]
};

// 密码强度计算
const getPasswordStrength = (password: string): PasswordStrength => {
  let strength = 0;
  if (password.length >= 8) strength++;
  if (password.length >= 12) strength++;
  if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
  if (/\d/.test(password)) strength++;
  if (/[!@#$%^&*]/.test(password)) strength++;
  
  if (strength <= 2) return 'weak';
  if (strength <= 4) return 'medium';
  return 'strong';
};
```

#### 3.1.3 忘记密码 ❌
```typescript
// 重置密码流程
interface ResetPasswordForm {
  account: string;        // 用户名/邮箱/手机号
  verifyType: 'email' | 'phone';
  verifyCode: string;
  newPassword: string;
  confirmPassword: string;
}

// 页面设计
- 步骤1：输入账号信息
- 步骤2：选择验证方式（邮箱/手机）
- 步骤3：输入验证码
- 步骤4：设置新密码
- 成功后跳转登录页
```

#### 3.1.4 安全机制 🚧
```typescript
// 登录安全策略
interface SecurityConfig {
  maxLoginAttempts: number;          // 最大登录尝试次数 ❌
  lockoutDuration: number;           // 账号锁定时长（分钟）❌
  captchaThreshold: number;          // 显示验证码的失败次数 ❌
  passwordPolicy: {                  // 密码策略 ❌
    minLength: number;
    requireUppercase: boolean;
    requireLowercase: boolean;
    requireNumbers: boolean;
    requireSpecialChars: boolean;
    maxAge: number;                  // 密码有效期（天）
  };
  sessionTimeout: number;            // 会话超时时间（分钟）✅（Sa-Token管理）
  concurrentSessions: boolean;       // 是否允许并发会话 ✅
}

// 登录日志记录
interface LoginLog {
  id: number;
  username: string;
  loginTime: Date;
  loginIp: string;
  userAgent: string;
  loginStatus: 'success' | 'failed';
  failReason?: string;
  location?: string;                 // IP地理位置
}
```

### 3.2 监控大屏 🚧

#### 3.2.1 实时请求统计 🚧
```typescript
// 数据结构
interface RealtimeStats {
  timestamp: number;
  metrics: {
    requestsPerSecond: number;    // QPS ❌
    totalRequests: number;        // 总请求数 🚧
    avgResponseTime: number;      // 平均响应时间(ms) 🚧
    errorRate: number;           // 错误率(%) 🚧
    activeConnections: number;    // 活跃连接数 ❌
  };
  statusCodeDistribution: {      // 状态码分布 ❌
    '2xx': number;
    '3xx': number;
    '4xx': number;
    '5xx': number;
  };
}

// 图表配置
- 实时QPS折线图 (每秒更新) ❌
- 响应时间分布图 (柱状图) ❌
- 错误率趋势图 (面积图) ❌
- 状态码分布饼图 ❌
```

实际实现：
- ✅ 监控页面框架
- ✅ ECharts集成
- ✅ WebSocket连接
- ❌ 实时数据推送
- ❌ 图表数据更新

#### 3.2.2 路由调用监控 ❌
```typescript
interface RouteMetrics {
  routeId: string;
  routeName: string;
  callCount: number;
  avgResponseTime: number;
  p95ResponseTime: number;
  p99ResponseTime: number;
  errorCount: number;
  errorRate: number;
  lastCallTime: Date;
}

// 功能设计
- TOP 10 热门路由排行
- TOP 10 慢响应路由
- 路由调用趋势图（可选择时间范围）
- 异常路由告警列表
```

#### 3.2.3 过滤器命中监控 ❌
```typescript
interface FilterMetrics {
  filterId: string;
  filterName: string;
  filterType: 'PRE' | 'POST' | 'ERROR';
  hitCount: number;
  blockCount: number;  // 拦截数
  avgProcessTime: number;
  lastHitTime: Date;
}

// 展示内容
- 过滤器命中率排行
- 限流拦截统计
- 鉴权失败统计
- 过滤器处理耗时分析
```

### 3.3 路由管理 ✅

#### 3.3.1 路由列表 ✅
```typescript
interface Route {
  id: number;
  routeId: string;                ✅
  name: string;                   ✅
  description: string;            ✅
  uri: string;                    ✅
  predicates: RoutePredicate[];   ✅
  filters: RouteFilter[];         ✅
  metadata: Record<string, any>;  ✅
  order: number;                  ✅
  enabled: boolean;               ✅
  grayscaleEnabled: boolean;      ❌（灰度未实现）
  grayscaleConfig?: GrayscaleConfig; ❌
  templateId?: number;            ❌（模板未实现）
  createdTime: Date;              ✅
  updatedTime: Date;              ✅
}

// 功能点
- 分页展示路由列表 ✅
- 支持按名称、URI、状态筛选 ✅
- 批量启用/禁用 ❌
- 导入导出配置（JSON/YAML）❌
- 快速复制路由 ❌
- 配置版本对比 ❌
```

#### 3.3.2 路由测试工具 ❌
```vue
<template>
  <div class="route-tester">
    <el-form>
      <el-form-item label="请求方法">
        <el-select v-model="method">
          <el-option value="GET"/>
          <el-option value="POST"/>
          <el-option value="PUT"/>
          <el-option value="DELETE"/>
        </el-select>
      </el-form-item>
      <el-form-item label="请求路径">
        <el-input v-model="path"/>
      </el-form-item>
      <el-form-item label="请求头">
        <HeaderEditor v-model="headers"/>
      </el-form-item>
      <el-form-item label="请求体">
        <CodeEditor v-model="body" language="json"/>
      </el-form-item>
    </el-form>
    
    <div class="test-result">
      <!-- 展示路由匹配结果、过滤器执行链、最终响应 -->
    </div>
  </div>
</template>
```

#### 3.3.3 配置模板管理 ❌
```typescript
interface RouteTemplate {
  id: number;
  name: string;
  description: string;
  category: string;          // 模板分类
  config: {
    predicates: RoutePredicate[];
    filters: RouteFilter[];
    metadata: Record<string, any>;
  };
  variables: {              // 模板变量
    name: string;
    type: 'string' | 'number' | 'boolean';
    defaultValue: any;
    required: boolean;
    description: string;
  }[];
  isSystem: boolean;        // 系统内置模板
  usageCount: number;       // 使用次数
}

// 功能设计
- 模板库管理（系统模板 + 自定义模板）
- 从现有路由创建模板
- 模板预览和测试
- 模板变量填充界面
- 模板使用统计
```

### 3.4 负载均衡配置 🚧
```typescript
interface LoadBalanceConfig {
  routeId: string;
  strategy: 'ROUND_ROBIN' | 'WEIGHTED' | 'LEAST_CONN' | 'IP_HASH' | 'RANDOM'; // 仅ROUND_ROBIN实现
  nodes: {
    nodeId: string;       ✅
    address: string;      ✅
    weight: number;       ✅（未使用）
    maxFails: number;     ❌
    failTimeout: number;  ❌
    backup: boolean;      ❌
  }[];
  healthCheck: {         ❌（健康检查未实现）
    enabled: boolean;
    interval: number;
    timeout: number;
    path: string;
    expectedStatus: number[];
  };
}

// UI设计
- 可视化节点权重配置（滑块调整）❌
- 实时节点健康状态展示 ❌
- 负载策略说明和最佳实践 ❌
- 节点流量分布实时图表 ❌
```

### 3.5 过滤器管理 🚧
```typescript
interface FilterChain {
  routeId: string;
  filters: {
    id: string;
    name: string;
    type: string;
    order: number;
    enabled: boolean;
    config: Record<string, any>;
  }[];
}

// 过滤器类型
- 请求头处理 (AddRequestHeader, RemoveRequestHeader) ❌
- 路径处理 (StripPrefix, RewritePath) ✅（仅StripPrefix）
- 限流 (RequestRateLimiter) ❌
- 熔断 (CircuitBreaker) ❌
- 重试 (Retry) ❌
- 鉴权 (Auth) ❌

// UI交互
- 拖拽调整过滤器顺序 ❌
- 过滤器配置表单动态生成 ✅
- 过滤器效果实时预览 ❌
- 过滤器模板快速应用 ❌
```

### 3.6 鉴权规则配置 ❌
```typescript
// 整个鉴权规则模块未实现
```

### 3.7 系统管理

#### 3.7.1 用户管理 ✅
```typescript
interface User {
  id: number;              ✅
  username: string;        ✅
  nickname: string;        ✅
  email: string;           ✅
  phone: string;           ✅
  avatar: string;          ✅
  roles: Role[];           ✅
  department: Department;  ❌（部门未实现）
  status: 'active' | 'inactive' | 'locked'; ✅
  lastLoginTime: Date;     ✅
  createdTime: Date;       ✅
}

// 功能列表
- 用户CRUD操作 ✅
- 批量角色分配 ✅
- 密码重置 ✅
- 登录历史查看 🚧（基础实现）
- 在线用户管理 ❌
```

#### 3.7.2 权限管理 ✅
```typescript
interface Permission {
  id: number;                     ✅
  code: string;                   ✅
  name: string;                   ✅
  type: 'menu' | 'button' | 'api'; ✅
  parentId: number;               ✅
  path?: string;                  ✅
  component?: string;             ✅
  icon?: string;                  ✅
  order: number;                  ✅
  visible: boolean;               ✅
  cached: boolean;                ❌
  resources: string[];            ❌
}

// 权限树结构展示
- 菜单权限配置 ✅
- 按钮权限控制 ❌（权限验证已禁用）
- API权限映射 ❌
- 数据权限规则 ❌
```

#### 3.7.3 灰度发布配置 ❌
```typescript
// 整个灰度发布功能未实现
```

## 4. 交互设计

### 4.1 页面布局
```
┌─────────────────────────────────────────────────────┐
│  Logo  │          顶部导航栏          │ 用户信息     │
├────────┼────────────────────────────────────────────┤
│        │                                            │
│  侧边  │              主内容区                       │
│  菜单  │                                            │
│        │                                            │
│        │                                            │
└────────┴────────────────────────────────────────────┘
```

### 4.2 交互规范
- **Loading状态**: 所有异步操作显示加载动画
- **错误处理**: 统一的错误提示样式
- **确认操作**: 危险操作需要二次确认
- **表单验证**: 实时验证 + 提交验证
- **快捷键**: 支持常用快捷键操作

### 4.3 响应式设计
- 最小支持分辨率: 1366x768
- 大屏自适应: 1920x1080, 2560x1440
- 不支持移动端（管理系统特性）

## 5. 性能优化

### 5.1 加载优化
- 路由懒加载 ✅
- 组件异步加载 ❌
- 静态资源CDN（生产环境）❌
- Gzip压缩 ❌
- 图片懒加载 ❌

### 5.2 运行时优化
- 虚拟滚动（大数据表格）❌
- 防抖节流（搜索、滚动）✅
- 组件缓存（keep-alive）❌
- 状态持久化（localStorage）✅

### 5.3 打包优化 ❌
```javascript
// vite.config.ts
// 未进行打包优化配置
```

## 6. 安全设计

### 6.1 认证安全
- JWT Token存储在内存 + localStorage（仅存储加密后的Token）❌（使用Sa-Token）
- Refresh Token机制，支持无感刷新 ❌
- 登录失败次数限制，超过阈值显示验证码 ❌
- 账号锁定机制，防止暴力破解 ❌
- 会话超时自动登出 ✅
- 异地登录检测和提醒 ❌
- 设备指纹识别 ❌

### 6.2 数据安全
- 敏感数据脱敏显示 ❌
- API请求签名验证 ❌
- 防止XSS攻击 ❌
- 防止CSRF攻击 ✅（Sa-Token自带）

### 6.3 权限控制
- 路由级权限控制 ✅
- 按钮级权限控制 ❌（权限验证已禁用）
- API级权限控制 ❌（权限验证已禁用）
- 数据级权限控制 ❌

## 7. 测试策略

### 7.1 单元测试
```typescript
// 示例：路由配置组件测试
describe('RouteConfig.vue', () => {
  it('should validate route form', async () => {
    const wrapper = mount(RouteConfig);
    await wrapper.find('#route-name').setValue('');
    await wrapper.find('#submit-btn').trigger('click');
    expect(wrapper.find('.el-form-item__error').text())
      .toBe('路由名称不能为空');
  });
});
```

### 7.2 集成测试
- API集成测试
- WebSocket连接测试
- 路由跳转测试
- 权限控制测试

### 7.3 E2E测试
```typescript
// Cypress示例
describe('Route Management', () => {
  it('should create new route', () => {
    cy.login('admin', 'admin123');
    cy.visit('/routes');
    cy.contains('新增路由').click();
    cy.get('#route-name').type('test-route');
    cy.get('#route-uri').type('http://example.com');
    cy.contains('确定').click();
    cy.contains('创建成功');
  });
});
```

## 8. 部署方案

### 8.1 构建流程
```bash
# 安装依赖
npm install

# 开发环境
npm run dev

# 生产构建
npm run build

# 构建产物输出到
../gateway-admin/src/main/resources/static/
```

### 8.2 环境配置
```typescript
// 环境变量配置
const envConfig = {
  development: {
    apiBaseUrl: 'http://localhost:8080/api',
    wsUrl: 'ws://localhost:8080/ws'
  },
  production: {
    apiBaseUrl: '/api',
    wsUrl: `ws://${window.location.host}/ws`
  }
};
```

### 8.3 部署检查清单
- [ ] 生产环境变量配置
- [ ] 静态资源路径正确
- [ ] API接口地址正确
- [ ] WebSocket地址正确
- [ ] 错误日志收集配置
- [ ] 性能监控配置

## 9. 维护与扩展

### 9.1 代码规范
- ESLint + Prettier配置
- Git提交规范（Conventional Commits）
- 代码审查要求

### 9.2 文档维护
- API文档自动生成
- 组件文档（Storybook）
- 用户使用手册

### 9.3 版本管理
- 语义化版本控制
- 变更日志维护
- 版本兼容性说明

## 10. 项目里程碑

### Phase 1: 基础功能（2周）
- [x] 项目搭建和基础架构 ✅
- [x] 登录认证和权限框架 ✅（权限验证已禁用）
- [x] 基础页面布局 ✅

### Phase 2: 核心功能（3周）
- [ ] 监控大屏实现 🚧（框架实现，数据未集成）
- [x] 路由管理功能 ✅
- [ ] 过滤器配置 🚧（基础实现）

### Phase 3: 高级功能（2周）
- [ ] 配置模板系统 ❌
- [ ] 灰度发布功能 ❌
- [ ] WebSocket实时通信 ✅（框架实现，数据未集成）

### Phase 4: 完善优化（1周）
- [ ] 性能优化 ❌
- [ ] 国际化完善 ❌
- [ ] 测试完善 ❌

## 11. 风险评估

### 技术风险
- WebSocket连接稳定性
- 大数据量渲染性能
- 浏览器兼容性

### 缓解措施
- WebSocket断线重连机制
- 虚拟滚动 + 分页加载
- 降级方案准备

## 12. 总结

本设计文档定义了Muxin Gateway管理系统前端的完整架构和实现方案。通过模块化设计、统一的技术栈和规范的开发流程，确保系统的可维护性和可扩展性。后续开发过程中，本文档将持续更新和完善。 