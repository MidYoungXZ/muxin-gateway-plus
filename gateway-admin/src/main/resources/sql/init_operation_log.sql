-- 操作日志表
CREATE TABLE `sys_operation_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `module` varchar(50) DEFAULT NULL COMMENT '模块名称',
  `operation` varchar(50) DEFAULT NULL COMMENT '操作类型',
  `method` varchar(10) DEFAULT NULL COMMENT '请求方法',
  `request_url` varchar(500) DEFAULT NULL COMMENT '请求URL',
  `params` text DEFAULT NULL COMMENT '请求参数',
  `result` text DEFAULT NULL COMMENT '返回结果',
  `error` text DEFAULT NULL COMMENT '异常信息',
  `duration` bigint DEFAULT NULL COMMENT '执行时长(ms)',
  `operator` varchar(50) DEFAULT NULL COMMENT '操作人',
  `operator_id` bigint DEFAULT NULL COMMENT '操作人ID',
  `operator_ip` varchar(50) DEFAULT NULL COMMENT '操作IP',
  `operator_location` varchar(100) DEFAULT NULL COMMENT '操作地点',
  `browser` varchar(100) DEFAULT NULL COMMENT '浏览器',
  `os` varchar(100) DEFAULT NULL COMMENT '操作系统',
  `status` tinyint DEFAULT NULL COMMENT '状态：0-失败，1-成功',
  `operate_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
  `deleted` tinyint DEFAULT '0' COMMENT '是否删除：0-否，1-是',
  PRIMARY KEY (`id`),
  KEY `idx_module` (`module`),
  KEY `idx_operation` (`operation`),
  KEY `idx_operator` (`operator`),
  KEY `idx_status` (`status`),
  KEY `idx_operate_time` (`operate_time`),
  KEY `idx_deleted` (`deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';

-- 插入测试数据
INSERT INTO `sys_operation_log` (`module`, `operation`, `method`, `request_url`, `params`, `result`, `error`, `duration`, `operator`, `operator_id`, `operator_ip`, `operator_location`, `browser`, `os`, `status`, `operate_time`, `deleted`) VALUES
('用户管理', '用户登录', 'POST', '/api/auth/login', '{"username":"admin","password":"******"}', '{"code":200,"message":"登录成功","data":{"token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."}}', NULL, 156, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 09:30:15', 0),
('用户管理', '创建用户', 'POST', '/api/users', '{"username":"testuser","email":"test@example.com","roleIds":[2,3]}', '{"code":200,"message":"用户创建成功","data":{"id":5,"username":"testuser"}}', NULL, 234, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 10:15:30', 0),
('角色管理', '创建角色', 'POST', '/api/roles', '{"roleName":"测试角色","roleCode":"test_role","description":"用于测试的角色"}', '{"code":200,"message":"角色创建成功","data":{"id":3,"roleName":"测试角色"}}', NULL, 189, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 10:30:45', 0),
('权限管理', '分配权限', 'PUT', '/api/roles/3/permissions', '{"roleId":3,"permissionIds":[1,2,3,4,5]}', '{"code":200,"message":"权限分配成功"}', NULL, 145, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 10:45:20', 0),
('部门管理', '创建部门', 'POST', '/api/dept', '{"deptName":"研发部","parentId":1,"description":"负责产品研发"}', '{"code":200,"message":"部门创建成功","data":{"id":6,"deptName":"研发部"}}', NULL, 167, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 11:00:10', 0),
('用户管理', '删除用户', 'DELETE', '/api/users/10', '{"id":10,"reason":"违规操作"}', NULL, '权限不足，无法删除管理员用户', 89, 'test', 2, '192.168.1.101', '上海市', 'Firefox 89.0', 'macOS Big Sur', 0, '2024-01-15 11:15:25', 0),
('系统设置', '修改配置', 'PUT', '/api/config/system', '{"siteName":"Muxin网关管理系统","version":"1.0.0","maxUploadSize":"10MB"}', '{"code":200,"message":"系统配置更新成功"}', NULL, 123, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 11:30:40', 0),
('操作日志', '导出日志', 'POST', '/api/system/logs/operation/export', '{"startTime":"2024-01-01 00:00:00","endTime":"2024-01-15 23:59:59","module":"用户管理"}', '{"code":200,"message":"日志导出成功","data":{"fileName":"operation_logs_20240115.csv","fileSize":"2.5MB"}}', NULL, 2345, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 11:45:55', 0),
('路由管理', '创建路由', 'POST', '/api/routes', '{"routeId":"test-route","routeName":"测试路由","uri":"http://localhost:8080","predicates":[{"name":"Path","args":{"pattern":"/test/**"}}]}', '{"code":200,"message":"路由创建成功","data":{"id":8,"routeId":"test-route"}}', NULL, 198, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 12:00:35', 0),
('过滤器管理', '启用过滤器', 'PUT', '/api/filters/5/enable', '{"filterId":5,"enabled":true}', '{"code":200,"message":"过滤器启用成功"}', NULL, 76, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 12:15:18', 0),
('监控管理', '查看监控', 'GET', '/api/metrics/overview', '{}', '{"code":200,"data":{"requestCount":15823,"successRate":98.5,"avgResponseTime":"156ms","errorCount":24}}', NULL, 45, 'viewer', 3, '192.168.1.102', '广州市', 'Safari 14.1', 'macOS Big Sur', 1, '2024-01-15 12:30:42', 0),
('用户管理', '修改密码', 'PUT', '/api/users/profile/password', '{"oldPassword":"******","newPassword":"******"}', NULL, '原密码错误', 67, 'test', 2, '192.168.1.101', '上海市', 'Firefox 89.0', 'macOS Big Sur', 0, '2024-01-15 12:45:33', 0),
('系统设置', '清理缓存', 'POST', '/api/system/cache/clear', '{"type":"all","modules":["user","role","permission"]}', '{"code":200,"message":"缓存清理成功","data":{"clearedCount":1256,"duration":"1.2s"}}', NULL, 1234, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 13:00:15', 0),
('数据备份', '备份数据库', 'POST', '/api/system/backup', '{"type":"full","includeLogs":false}', '{"code":200,"message":"数据库备份完成","data":{"fileName":"backup_20240115_1315.sql","fileSize":"156MB","duration":"15.6s"}}', NULL, 15678, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 13:15:28', 0),
('用户管理', '用户登出', 'POST', '/api/auth/logout', '{}', '{"code":200,"message":"登出成功"}', NULL, 34, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 13:30:45', 0),
('网关管理', '路由测试', 'POST', '/api/routes/test', '{"routeId":"test-route","testUrl":"/test/hello","method":"GET"}', '{"code":200,"message":"路由测试成功","data":{"responseTime":"89ms","statusCode":200}}', NULL, 892, 'developer', 4, '192.168.1.103', '深圳市', 'Edge 91.0', 'Windows 11', 1, '2024-01-15 14:00:20', 0),
('负载均衡', '修改配置', 'PUT', '/api/loadbalance/config', '{"strategy":"round_robin","healthCheck":{"enabled":true,"interval":"30s"}}', '{"code":200,"message":"负载均衡配置更新成功"}', NULL, 123, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 14:15:10', 0),
('API权限', '创建权限规则', 'POST', '/api/auth/rules', '{"name":"测试API权限","pattern":"/test/**","roles":["test_role"],"enabled":true}', '{"code":200,"message":"权限规则创建成功","data":{"id":12}}', NULL, 178, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 14:30:35', 0),
('白名单管理', '添加IP', 'POST', '/api/whitelist/ip', '{"ip":"192.168.2.100","description":"开发环境IP","expiresAt":"2024-12-31 23:59:59"}', '{"code":200,"message":"IP白名单添加成功"}', NULL, 145, 'security', 5, '192.168.1.104', '杭州市', 'Chrome 91.0', 'Linux Ubuntu', 1, '2024-01-15 14:45:22', 0),
('操作日志', '清理历史日志', 'POST', '/api/system/logs/operation/clean?days=90', '{"days":90,"confirm":true}', '{"code":200,"message":"历史日志清理完成","data":{"cleanedCount":2340}}', NULL, 3456, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 15:00:40', 0),
('系统监控', '查看系统状态', 'GET', '/api/system/status', '{}', '{"code":200,"data":{"cpuUsage":"45%","memoryUsage":"68%","diskUsage":"32%","uptime":"7天3小时"}}', NULL, 67, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 15:15:55', 0),
('文件管理', '上传文件', 'POST', '/api/files/upload', '{"fileName":"config.json","fileSize":"2.3KB","fileType":"application/json"}', '{"code":200,"message":"文件上传成功","data":{"fileId":"f1234567","downloadUrl":"/api/files/download/f1234567"}}', NULL, 1890, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 15:30:12', 0),
('数据统计', '生成报表', 'POST', '/api/reports/generate', '{"type":"daily","date":"2024-01-15","modules":["user","route","filter"]}', '{"code":200,"message":"报表生成成功","data":{"reportId":"r20240115001","fileSize":"5.2MB"}}', NULL, 4567, 'analyst', 6, '192.168.1.105', '成都市', 'Firefox 89.0', 'Windows 10', 1, '2024-01-15 15:45:30', 0),
('用户管理', '批量导入用户', 'POST', '/api/users/import', '{"fileName":"users.xlsx","total":500,"validCount":485}', NULL, '导入文件格式错误：第15行缺少必填字段email', 234, 'hr', 7, '192.168.1.106', '武汉市', 'Chrome 91.0', 'Windows 10', 0, '2024-01-15 16:00:45', 0),
('系统设置', '更新许可证', 'PUT', '/api/system/license', '{"licenseKey":"MUXIN-GATEWAY-2024-ENTERPRISE","validUntil":"2025-01-15"}', '{"code":200,"message":"许可证更新成功","data":{"validUntil":"2025-01-15","features":["unlimited_routes","advanced_monitoring"]}}', NULL, 892, 'admin', 1, '192.168.1.100', '北京市', 'Chrome 91.0', 'Windows 10', 1, '2024-01-15 16:15:20', 0); 